---
export async function getStaticPaths() {
  const response = await fetch(
    // "https://ms-prd-prd.globusgroup.com/indexes/staging_products_uk_en-gb/search",
    "http://localhost:7700/indexes/staging_products_uk_en-gb/search", 
    {
      method: "POST",
      headers: {
        Authorization:
          // "Bearer de0eef89f10d34658c1938d82e2203b9f1940d91c043c2c1e5a90cfce9729ebf",
          "Bearer df7b16d3dda117c0e2118b283b1b3fe21f331daaec06d9eb993dc7eb8ab162ef",  
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ q: "", limit: 100000 }),
    },
  );

  const data = await response.json();
  return data.hits.map((hit: any) => ({
    params: { product: hit.slug }, // ⬅️ pass just the slug!
  }));
}

const { product } = Astro.params;

// Now, fetch this product by slug:
const response = await fetch(
  // "https://ms-prd-prd.globusgroup.com/indexes/staging_products_uk_en-gb/search",
  "http://localhost:7700/indexes/staging_products_uk_en-gb/search", 
  {
    method: "POST",
    headers: {
      Authorization:
        // "Bearer de0eef89f10d34658c1938d82e2203b9f1940d91c043c2c1e5a90cfce9729ebf",
        "Bearer df7b16d3dda117c0e2118b283b1b3fe21f331daaec06d9eb993dc7eb8ab162ef",
      "Content-Type": "application/json",
    },
    body: JSON.stringify({ q: product }),
  },
);
const { hits } = await response.json();
const p = hits[0];
---

<html>
  <body>
    <h1>{p.web_title}</h1>
    <hr>
    <div>{p.long_description}</div>
    <hr>
    <p>Slug: {product}</p>
  </body>
</html>
